/* ==========================================
   THEME VARIABLES & RESET
   ========================================== */
:root {
    --bg-body: #d4d4d4;         /* Outer Background */
    --bg-card: #f9f9f7;         /* Paper Background */
    --text-primary: #1a1a1a;    /* Ink Black */
    --text-secondary: #555555;  /* Grey Text */
    --text-muted: #888888;      /* Muted Text */
    --accent-red: #a84444;      /* Stamp Red */
    --alert-bg: #eee4e4;
    --line-color: #e0e0e0;
    --font-serif: 'Noto Serif SC', 'Playfair Display', serif;
    --font-sans: 'Inter', sans-serif;
}

/* Override any default styles */
#cte-map-panel * {
    box-sizing: border-box;
}

/* ==========================================
   MAIN PANEL CONTAINER (Archive Card)
   ========================================== */
#cte-map-panel {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    
    width: 760px;
    height: 85vh;
    max-height: 900px;
    
    background: var(--bg-card) !important; /* Force override dark mode */
    border: none !important;
    border-radius: 4px;
    
    /* Paper shadow effect */
    box-shadow: 0 15px 35px rgba(0,0,0,0.15), 0 5px 10px rgba(0,0,0,0.05) !important;
    
    z-index: 20000;
    display: none;
    overflow: hidden; 
    font-family: var(--font-sans);
    color: var(--text-primary);
    padding: 0;
}

/* ==========================================
   HEADER & NAVIGATION
   ========================================== */
#cte-drag-handle {
    width: 100%;
    height: 50px;
    background: transparent !important; /* Remove dark bg */
    border-bottom: 2px solid var(--text-primary) !important;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 20px;
    cursor: move;
    color: var(--text-primary) !important;
}

/* Title text in drag handle */
#cte-drag-handle span:first-child {
    font-family: var(--font-serif);
    font-weight: 700;
    font-size: 16px;
    letter-spacing: 1px;
    text-transform: uppercase;
}

/* Navigation Buttons */
.cte-nav-btn {
    background: transparent;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    font-family: var(--font-sans);
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    padding: 4px 12px;
    transition: all 0.2s;
    border-radius: 2px;
}

.cte-nav-btn.active {
    color: var(--bg-card);
    background-color: var(--accent-red);
    border-bottom: none !important;
}

.cte-nav-btn:hover:not(.active) {
    color: var(--accent-red);
}

/* Close Button */
#cte-close-btn {
    font-family: var(--font-sans);
    opacity: 0.5;
    transition: opacity 0.2s;
}
#cte-close-btn:hover { opacity: 1; }

/* Content Area */
#cte-content-area {
    height: calc(100% - 50px);
    width: 100%;
    position: relative;
    overflow: hidden;
    background-color: var(--bg-card) !important;
}

/* ==========================================
   VIEW CONTAINERS & TYPOGRAPHY
   ========================================== */
.cte-view {
    width: 100%;
    height: 100%;
    overflow-y: auto;
    padding: 20px 30px;
    display: none;
    background: var(--bg-card) !important;
}

.cte-view.active { display: block; }

/* Scrollbar Styling */
.cte-view::-webkit-scrollbar { width: 6px; }
.cte-view::-webkit-scrollbar-track { background: transparent; }
.cte-view::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }

/* Archive Header Style (H1 replacement) */
.archive-header {
    margin-bottom: 20px;
}

.header-date {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
    margin-bottom: 8px;
    border-bottom: 4px solid var(--text-primary);
    padding-bottom: 8px;
}

.cte-wrapper h1 {
    font-family: var(--font-serif);
    font-weight: 700;
    font-size: 28px;
    color: var(--text-primary);
    margin: 0;
    letter-spacing: -0.5px;
    line-height: 1;
}

.time-badge {
    font-family: var(--font-sans);
    font-size: 12px;
    font-weight: 600;
    color: var(--text-primary);
    background: #eadddd;
    padding: 2px 8px;
    border-radius: 2px;
}

.meta-block {
    font-size: 11px;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    gap: 8px;
}

.meta-primary {
    font-family: var(--font-serif);
    font-weight: 700;
}
.meta-secondary { text-transform: uppercase; letter-spacing: 0.5px; }
.divider-v { color: #ccc; }

/* Controls Bar */
.controls-bar {
    background: #fff;
    border: 1px solid var(--line-color);
    padding: 10px;
    margin-bottom: 20px;
    border-radius: 2px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    color: var(--text-secondary);
}

.cte-btn {
    border: 1px solid var(--text-primary);
    color: var(--text-primary);
    background-color: transparent;
    padding: 5px 12px;
    border-radius: 2px;
    cursor: pointer;
    font-family: var(--font-sans);
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    transition: all 0.2s;
}

.cte-btn:hover {
    background-color: var(--text-primary);
    color: var(--bg-card);
}

.cte-btn.primary {
    background-color: var(--accent-red);
    border-color: var(--accent-red);
    color: white;
}
.cte-btn.primary:hover {
    background-color: #8a3636;
}

/* ==========================================
   MAP VIEW
   ========================================== */
.map-frame {
    padding: 10px;
    background: #fff;
    border: 1px solid var(--line-color);
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    margin-bottom: 30px;
    width: 100%;
    max-width: 700px;
}

.map-container, .national-map-container {
    width: 100%;
    aspect-ratio: 1 / 1;
    background-color: #e0e0e0;
    background-size: cover;
    background-position: center;
    position: relative;
    overflow: hidden;
    border: 1px solid var(--text-primary);
}

.location {
    position: absolute;
    cursor: grab;
    background-color: #fff !important;
    border: 2px solid var(--accent-red) !important;
    padding: 4px 10px;
    border-radius: 12px;
    color: var(--text-primary) !important;
    font-family: var(--font-sans);
    font-size: 11px;
    font-weight: 700;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transform: translate(-50%, -50%);
    transition: transform 0.2s;
    z-index: 10;
}

.location:hover {
    z-index: 20;
    background-color: var(--accent-red) !important;
    color: white !important;
    transform: translate(-50%, -50%) scale(1.1);
}

.location.dragging { opacity: 0.8; cursor: grabbing; }

/* National Map Cities */
.national-city {
    position: absolute;
    display: flex;
    flex-direction: column;
    align-items: center;
    cursor: grab;
    transform: translate(-50%, -50%);
}

.national-city i {
    font-size: 20px;
    color: var(--accent-red);
    background: #fff;
    border-radius: 50%;
    padding: 5px;
    border: 1px solid var(--text-primary);
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.national-city .name {
    margin-top: 4px;
    background: #fff;
    border: 1px solid var(--text-primary);
    padding: 2px 6px;
    font-size: 10px;
    font-weight: 700;
    color: var(--text-primary);
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.brief-box {
    background-color: #f0f0ed;
    padding: 15px;
    border-left: 3px solid var(--accent-red);
    margin-top: 20px;
    color: var(--text-primary);
}
.brief-box h2 {
    font-family: var(--font-serif);
    font-size: 16px;
    margin-top: 0;
    color: var(--accent-red);
}

/* ==========================================
   SCHEDULE / TIMELINE (Dossier List)
   ========================================== */
.section-divider {
    border-top: 1px solid var(--line-color);
    margin: 20px 0 15px 0;
    position: relative;
    width: 100%;
}

.section-label {
    position: absolute;
    top: -8px;
    background-color: var(--bg-card);
    padding-right: 10px;
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--text-muted);
    font-weight: 600;
}

.dossier-list {
    width: 100%;
    max-width: 700px;
}

/* Retargeting existing JS classes to new style */
.cte-timeline-item {
    display: flex;
    flex-direction: column;
    padding: 10px 0;
    border-bottom: 1px dashed var(--line-color);
    margin-bottom: 0;
    position: relative;
}

.cte-timeline-item::before { display: none; /* Remove old vertical line */ }

.cte-timeline-time {
    position: static;
    font-family: var(--font-sans);
    font-size: 10px;
    color: var(--text-muted);
    background: transparent;
    border: none;
    text-align: left;
    margin-bottom: 4px;
    width: auto;
}

.cte-timeline-time::before {
    content: "\f017"; /* Clock icon */
    font-family: "Font Awesome 6 Free";
    font-weight: 400;
    margin-right: 4px;
}

.cte-timeline-content {
    background: transparent;
    border: none;
    border-left: none;
    padding: 0;
    width: 100%;
}

.cte-timeline-content:hover {
    transform: none;
    box-shadow: none;
}

.cte-schedule-title {
    font-family: var(--font-serif);
    font-size: 14px;
    color: var(--text-primary);
    font-weight: 700;
}

.cte-tag {
    background-color: transparent;
    border: 1px solid var(--text-primary);
    color: var(--text-primary);
    font-size: 9px;
    padding: 1px 4px;
    border-radius: 2px;
    text-transform: uppercase;
}

.cte-exec-btn {
    background: transparent;
    border: 1px solid var(--line-color);
    color: var(--text-secondary);
    margin-top: 8px;
    padding: 4px;
    border-radius: 2px;
    font-size: 10px;
    width: auto;
    display: inline-block;
}
.cte-exec-btn:hover {
    background: var(--text-primary);
    color: white;
}

/* ==========================================
   RPG MANAGER (Financial Report)
   ========================================== */
.cte-rpg-container {
    background: var(--bg-card) !important;
    display: flex;
    height: 100%;
    color: var(--text-primary);
}

.cte-rpg-sidebar {
    background: #f0f0ed;
    border-right: 1px solid var(--line-color);
    width: 50px;
    padding-top: 20px;
}

.cte-rpg-logo {
    border: 1px solid var(--text-primary);
    color: var(--text-primary);
    width: 32px; height: 32px;
    margin-bottom: 30px;
    box-shadow: none;
    background: white;
}

.cte-rpg-logo span { color: var(--text-primary); }

.cte-rpg-nav-btn {
    color: var(--text-muted);
}
.cte-rpg-nav-btn.active, .cte-rpg-nav-btn:hover {
    color: var(--accent-red);
    background: rgba(0,0,0,0.05);
}

.cte-rpg-main { background: var(--bg-card); }

/* HUD Styling */
.cte-rpg-hud {
    background: #fff;
    border-bottom: 2px solid var(--text-primary);
    height: 60px;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
    color: var(--text-primary);
}

.hud-title {
    font-family: var(--font-serif);
    font-weight: 700;
    font-size: 14px;
    letter-spacing: 1px;
}

.cte-rpg-res-group { gap: 30px; }

.cte-rpg-res-item {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    justify-content: center;
}

.cte-rpg-res-icon { display: none; /* Hide icons in header for cleaner look */ }

.cte-rpg-res-label {
    font-size: 9px;
    color: var(--text-muted);
    font-weight: 700;
    letter-spacing: 0.5px;
}

.cte-rpg-res-val {
    font-family: 'Playfair Display', serif;
    font-size: 18px;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1;
}

/* Cards (Personnel Files) */
.cte-rpg-card {
    background: #fff;
    border: 1px solid var(--line-color);
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    padding: 15px;
    color: var(--text-primary);
}

.cte-rpg-card:hover {
    border-color: var(--accent-red);
    background: #fff;
}

.cte-rpg-avatar-box {
    border: 1px solid var(--line-color);
    width: 60px; height: 60px;
}

.cte-rpg-role-tag {
    background: var(--text-primary);
    color: white;
    border: none;
    font-family: var(--font-sans);
}

/* Stat Bars Override */
.cte-rpg-stat-bar-container .bar-bg {
    background: #eee;
    height: 4px;
}

/* JS injects inline colors. We use !important or attribute selectors to override */
.cte-rpg-stat-bar-container .bar-fill {
    box-shadow: none !important;
}

/* Gold becomes Black */
div[style*="background:#c5a065"], div[style*="background: rgb(197, 160, 101)"] {
    background-color: var(--text-primary) !important;
}
/* Pink becomes Red */
div[style*="background:#ec4899"], div[style*="background: rgb(236, 72, 153)"] {
    background-color: var(--accent-red) !important;
}
span[style*="color:#ec4899"], span[style*="color: rgb(236, 72, 153)"] {
    color: var(--accent-red) !important;
}
span[style*="color:#f43f5e"] { color: var(--accent-red) !important; }
div[style*="background:#f43f5e"] { background-color: var(--accent-red) !important; }

/* Dashboard List */
.cte-rpg-card ul li {
    border-bottom: 1px dashed var(--line-color) !important;
    color: var(--text-secondary) !important;
}

/* ==========================================
   HEARTBEAT VIEW (Confidential Log)
   ========================================== */
#cte-view-heartbeat {
    background-color: var(--bg-card) !important;
}

.cte-hb-container {
    background-color: transparent;
    color: var(--text-primary);
}

.cte-hb-header {
    background: transparent;
    border-bottom: 2px solid var(--accent-red);
    padding: 10px 0 20px 0;
    text-align: left;
}

.cte-hb-header h1 {
    color: var(--text-primary);
    font-size: 24px;
    text-shadow: none;
}

.cte-hb-activity-card {
    background: #fff;
    border: 1px solid var(--line-color);
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    border-radius: 2px;
    padding: 20px;
}

.cte-hb-activity-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border-color: var(--accent-red);
}

.cte-hb-activity-icon {
    color: var(--accent-red);
    font-size: 1.5rem;
}

.cte-hb-activity-name {
    font-family: var(--font-serif);
    color: var(--text-primary);
    font-size: 16px;
}

.cte-hb-activity-desc {
    color: var(--text-secondary);
    font-family: var(--font-sans);
}

.cte-hb-btn {
    background-color: white;
    color: var(--text-primary);
    border: 1px solid var(--text-primary);
    border-radius: 2px;
    padding: 4px 12px;
    text-transform: uppercase;
    font-weight: 600;
}

.cte-hb-btn:hover {
    background-color: var(--accent-red);
    border-color: var(--accent-red);
    color: white;
}

/* ==========================================
   POPUPS (Sticky Notes / Index Cards)
   ========================================== */
.paper-popup {
    background-color: #fff !important;
    border: 1px solid #ccc !important;
    border-top: 4px solid var(--accent-red) !important; /* Red top border like index card */
    box-shadow: 0 10px 25px rgba(0,0,0,0.2) !important;
    color: var(--text-primary) !important;
    border-radius: 2px;
}

.popup-header h3 {
    font-family: var(--font-serif);
    color: var(--text-primary) !important;
    border-bottom: 1px solid var(--line-color) !important;
    padding-bottom: 10px;
    margin-top: 0;
}

.popup-desc, .popup-instruction {
    color: var(--text-secondary) !important;
    font-family: var(--font-sans);
    font-size: 13px;
    line-height: 1.5;
}

.popup-image, .interior-image {
    border: 1px solid var(--line-color) !important;
    padding: 4px;
    background: #fff;
}

.popup-actions {
    margin-top: 20px;
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    border-top: 1px solid var(--line-color);
    padding-top: 15px;
}

/* Interior Menu */
.sub-menu-overlay {
    background: rgba(255, 255, 255, 0.95) !important;
    color: var(--text-primary);
}

.sub-item-btn {
    background: white;
    border: 1px solid var(--text-primary);
    color: var(--text-primary);
    font-family: var(--font-sans);
}
.sub-item-btn:hover {
    background: var(--text-primary);
    color: white;
}

.sub-menu-close { color: var(--text-muted); }

/* Character Detail in Popup */
.character-room-detail {
    border: 1px solid var(--line-color);
    background: #f9f9f7;
    padding: 15px;
}

.character-portrait {
    border: 1px solid var(--line-color);
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.character-info {
    background: white;
    border: 1px solid var(--line-color);
    color: var(--text-primary);
}

.info-row { border-bottom-color: var(--line-color); }

.info-label { color: var(--text-secondary); }
.info-value { color: var(--text-primary); font-weight: 600; }

.room-description {
    background: #fff;
    border-left: 3px solid var(--text-primary);
    color: var(--text-secondary);
}
.room-description p { color: var(--text-secondary); }

/* User Avatar */
.user-portrait::before {
    /* Change glow to subtle grey/red pulse */
    background: linear-gradient(45deg, #ccc, #fff, #ccc, #a84444);
}
.user-portrait::after { color: var(--accent-red); }

/* Participant Checkboxes */
.participant-item {
    background: white;
    border: 1px solid var(--line-color);
    color: var(--text-primary);
}
.participant-item:hover {
    background: #f0f0f0;
    border-color: var(--text-primary);
}
.participant-item label { color: var(--text-primary); }
.cte-checkbox { accent-color: var(--accent-red); }

/* Inputs */
.travel-input {
    background: #fff !important;
    border: 1px solid var(--text-primary) !important;
    color: var(--text-primary) !important;
    padding: 8px;
    font-family: var(--font-sans);
}

/* ==========================================
   GLOBAL TOGGLE BUTTON (Override)
   ========================================== */
/* The ID #cte-toggle-btn is injected by JS with inline gold background. */
div#cte-toggle-btn {
    background-color: var(--accent-red) !important;
    border: 2px solid white !important;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3) !important;
    color: white !important;
}

/* Overlay */
.popup-overlay {
    background: rgba(26, 26, 26, 0.6) !important; /* Darker dim for focus */
    backdrop-filter: blur(2px);
}
