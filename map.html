<!-- 视图切换容器 -->
<div id="cte-idol-view-map" class="cte-idol-view active">
    <div class="cte-idol-wrapper">
        <h1>京港市地图 - 档案模式</h1>
        <h2>双击标签查看详情，长按拖拽标签移动</h2>

        <div class="cte-idol-controls-bar">
            <!-- [原有功能保持] -->
            <button class="cte-idol-btn" onclick="window.CTEIdolManager.switchView('national-map')">🗺️ 前往国家地图</button>
            <span style="border-right: 1px solid #444; margin: 0 10px; height: 15px;"></span>
            <span>更换背景：</span>
            <button class="cte-idol-btn" onclick="document.getElementById('cte-idol-bg-upload').click()">📂 选择图片...</button>
            <input type="file" id="cte-idol-bg-upload" accept="image/*" style="display:none;" onchange="window.CTEIdolManager.changeBackground(this)">
            <span style="margin-left:auto; font-size: 12px; color: #888;">提示：坐标位置会自动保存</span>
        </div>

        <div class="cte-idol-map-container" id="cte-idol-map-container">
            <div class="cte-idol-location" id="cte-idol-loc-gov" style="top: 60%; left: 50%;" data-popup="cte-idol-gov-popup"><span class="label">京港市政府</span></div>
            <div class="cte-idol-location" id="cte-idol-loc-villa" style="top: 15%; left: 25%;" data-popup="cte-idol-villa-popup"><span class="label">私人别墅</span></div>
            <div class="cte-idol-location" id="cte-idol-loc-dorm" style="top: 15%; left: 50%;" data-popup="cte-idol-dorm-popup"><span class="label">CTE宿舍</span></div>
            <div class="cte-idol-location" id="cte-idol-loc-PrivateClub" style="top: 15%; left: 75%;" data-popup="cte-idol-PrivateClub-popup"><span class="label">私人会所</span></div>
            <div class="cte-idol-location" id="cte-idol-loc-airport" style="top: 35%; left: 85%;" data-popup="cte-idol-airport-popup"><span class="label">机场</span></div>
            <div class="cte-idol-location" id="cte-idol-loc-port" style="top: 65%; left: 85%;" data-popup="cte-idol-port-popup"><span class="label">港口</span></div>
            <div class="cte-idol-location" id="cte-idol-loc-office4" style="top: 25%; left: 15%;" data-popup="cte-idol-office4-popup"><span class="label">隆桑集团</span></div>
            <div class="cte-idol-location" id="cte-idol-loc-office3" style="top: 35%; left: 10%;" data-popup="cte-idol-office3-popup"><span class="label">盛华集团</span></div>
            <div class="cte-idol-location" id="cte-idol-loc-office" style="top: 60%; left: 15%;" data-popup="cte-idol-office-popup"><span class="label">远洋集团</span></div>
            <div class="cte-idol-location" id="cte-idol-loc-TVstation" style="top: 65%; left: 20%;" data-popup="cte-idol-TVstation-popup"><span class="label">京港电视台</span></div>
            <div class="cte-idol-location" id="cte-idol-loc-office2" style="top: 70%; left: 15%;" data-popup="cte-idol-office2-popup"><span class="label">万城娱乐</span></div>
            <div class="cte-idol-location" id="cte-idol-loc-highschool" style="top: 85%; left: 30%;" data-popup="cte-idol-highschool-popup"><span class="label">京港第三高中</span></div>
            <div class="cte-idol-location" id="cte-idol-loc-other-places" style="top: 85%; left: 85%;" data-popup="cte-idol-other-places-popup"><span class="label">其他地点</span></div>
        </div>
    </div>
</div>

<!-- [原有] 国家地图视图 -->
<div id="cte-idol-view-national-map" class="cte-idol-view">
    <div class="cte-idol-wrapper" style="width: 95%;">
        <h1>权贵之心：国家战略地图</h1>
        <p style="font-family: 'Zhi Mang Xing', cursive; color: #a0a0a0; margin-top: 0px; letter-spacing: 1px; font-size: 14px;">一张错综复杂的权力地图，一场没有硝烟的资本战争</p>
        
        <div class="cte-idol-controls-bar" style="justify-content: center;">
             <button class="cte-idol-btn" onclick="window.CTEIdolManager.switchView('map')">↩️ 返回京港市</button>
        </div>

        <!-- 国家地图容器 -->
        <div class="cte-idol-national-map-container" id="cte-idol-national-game-map">
            <!-- 城市将由 JS 注入 -->
        </div>

        <div class="cte-idol-national-info-panel">
            <div id="cte-idol-national-info-content">
                <h2><i class="fa-solid fa-map-location-dot"></i> 战略情报中心</h2>
                <p>请点击地图上的城市图标以获取详细情报...</p>
                <p style="font-size: 12px; color: #888; margin-top: 10px;">提示：点击“京港”图标可直接返回市内地图。</p>
            </div>
        </div>
    </div>
</div>

<!-- [原有] 行程表视图 -->
<div id="cte-idol-view-schedule" class="cte-idol-view">
    <div class="cte-idol-wrapper">
        <h1>当前行程安排</h1>
        <h2 id="cte-idol-schedule-status">正在读取最新状态...</h2>
        
        <div class="cte-idol-controls-bar">
            <button class="cte-idol-btn" onclick="window.CTEIdolManager.refreshSchedule()">🔄 刷新行程 (读取 status_top)</button>
        </div>

        <div id="cte-idol-timeline-container" class="cte-idol-timeline-container">
            <!-- 动态生成的时间轴内容 -->
            <p style="text-align:center; color:#666; margin-top:50px;">暂无行程数据，请确保聊天记录中包含 &lt;status_top&gt; 标签。</p>
        </div>
    </div>
</div>

<!-- [新增] 偶像事务所 RPG 管理终端视图 -->
<div id="cte-idol-view-manager" class="cte-idol-view" style="background-color: #0d0d0d;">
    <div class="cte-idol-rpg-container">
        <!-- 侧边栏 -->
        <div class="cte-idol-rpg-sidebar">
            <div class="cte-idol-rpg-logo"><span>M</span></div>
            <button class="cte-idol-rpg-nav-btn active" data-subview="dashboard" title="概览"><i class="fa-solid fa-chart-pie"></i></button>
            <button class="cte-idol-rpg-nav-btn" data-subview="roster" title="艺人阵容"><i class="fa-solid fa-users"></i></button>
            <button class="cte-idol-rpg-nav-btn" data-subview="agency" title="事务所运营"><i class="fa-solid fa-building"></i></button>
            <button class="cte-idol-rpg-nav-btn" data-subview="shop" title="采购中心"><i class="fa-solid fa-cart-shopping"></i></button>
            <button class="cte-idol-rpg-nav-btn" data-subview="news" title="每日快报"><i class="fa-solid fa-newspaper"></i></button>
        </div>
        
        <!-- 主内容区 -->
        <div class="cte-idol-rpg-main">
            <!-- 顶部 HUD -->
            <div class="cte-idol-rpg-hud">
                <div style="font-family:'Cinzel',serif; font-weight:bold; color:var(--cte-idol-accent-gold); letter-spacing:2px;">IDOL OS v2.4</div>
                <div class="cte-idol-rpg-res-group">
                    <div class="cte-idol-rpg-res-item">
                        <div class="cte-idol-rpg-res-icon" style="color:#DDB753"><i class="fa-solid fa-coins"></i></div>
                        <div><span class="cte-idol-rpg-res-val" id="cte-idol-rpg-val-funds">Loading...</span><span class="cte-idol-rpg-res-label">预算</span></div>
                    </div>
                    <div class="cte-idol-rpg-res-item">
                        <div class="cte-idol-rpg-res-icon" style="color:#F472B6"><i class="fa-solid fa-heart"></i></div>
                        <div><span class="cte-idol-rpg-res-val" id="cte-idol-rpg-val-fans">Loading...</span><span class="cte-idol-rpg-res-label">粉丝数</span></div>
                    </div>
                    <div class="cte-idol-rpg-res-item">
                        <div class="cte-idol-rpg-res-icon" style="color:#60A5FA"><i class="fa-solid fa-fire"></i></div>
                        <div><span class="cte-idol-rpg-res-val" id="cte-idol-rpg-val-morale">High</span><span class="cte-idol-rpg-res-label">团魂</span></div>
                    </div>
                </div>
            </div>

            <!-- RPG 子视图内容容器 -->
            <div id="cte-idol-rpg-content-area" style="flex:1; padding: 20px; overflow-y: auto;">
                <!-- 动态注入 RPG 内容 -->
                <div style="color: #666;">正在连接 SillyTavern 神经接口...</div>
            </div>
        </div>
    </div>
</div>

<!-- [REPLACED] Heartbeat (Netflix Style) View Container -->
<div id="cte-idol-view-heartbeat" class="cte-idol-view cte-nf-container">
    <!-- NAV -->
    <nav class="cte-nf-navbar">
        <div style="display:flex; align-items:center; gap:30px;">
            <div class="cte-nf-brand-logo">CTE-LOVE</div>
            <div class="cte-nf-nav-links">
                <span class="cte-nf-nav-link active">Home</span>
                <span class="cte-nf-nav-link">Series</span>
                <span class="cte-nf-nav-link">Films</span>
                <span class="cte-nf-nav-link">My List</span>
            </div>
        </div>
        <div>
            <span class="cte-nf-nav-link" onclick="window.CTEIdolManager.switchView('map')" style="margin-right: 20px; font-weight:bold; cursor:pointer;">EXIT <i class="fa-solid fa-right-from-bracket"></i></span>
            <div style="display:inline-block; width:30px; height:30px; background:#E50914; border-radius:4px; vertical-align:middle;"></div>
        </div>
    </nav>

    <!-- HERO -->
    <div class="cte-nf-billboard">
        <div class="cte-nf-billboard-content">
            <h1 class="cte-nf-billboard-title">Heartbeat System</h1>
            <p class="cte-nf-billboard-desc">
                活动成员可多选 <br>
                按住鼠标滚轮向右滚动，还有更多活动
            </p>
            <div class="cte-nf-billboard-buttons">
                <!-- Smooth scroll to rows -->
                <button class="cte-nf-btn cte-nf-btn-play" onclick="document.getElementById('cte-nf-content-anchor').scrollIntoView({behavior: 'smooth'})">
                    <i class="fa-solid fa-play"></i> Play
                </button>
                <button class="cte-nf-btn cte-nf-btn-info">
                    <i class="fa-solid fa-circle-info"></i> More Info
                </button>
            </div>
        </div>
    </div>

    <!-- CONTENT ROWS Anchor -->
    <div id="cte-nf-content-anchor"></div>

    <!-- CONTENT ROWS -->
    <div class="cte-nf-content-rows">
        
        <!-- Row 1 -->
        <div class="cte-nf-row">
            <h3 class="cte-nf-row-title">Trending Now</h3>
            <div class="cte-nf-row-scroller" id="cte-nf-row1">
                <!-- JS Injected -->
            </div>
        </div>

        <!-- Row 2 -->
        <div class="cte-nf-row">
            <h3 class="cte-nf-row-title">Intimate & Private</h3>
            <div class="cte-nf-row-scroller" id="cte-nf-row2">
                <!-- JS Injected -->
            </div>
        </div>

        <!-- Row 3 -->
        <div class="cte-nf-row">
            <h3 class="cte-nf-row-title">Exciting & Public</h3>
            <div class="cte-nf-row-scroller" id="cte-nf-row3">
                <!-- JS Injected -->
            </div>
        </div>

    </div>

    <!-- MODAL -->
    <div id="cte-nf-modal" class="cte-nf-modal" onclick="if(event.target === this) window.CTEIdolManager.Heartbeat.closeModal()">
        <div class="cte-nf-modal-content">
            <div class="cte-nf-modal-header">
                <span class="cte-nf-modal-title">Who's playing with you?</span>
                <button class="cte-nf-close-btn" onclick="window.CTEIdolManager.Heartbeat.closeModal()">&times;</button>
            </div>
            
            <div class="cte-nf-profile-grid" id="cte-nf-profile-grid">
                <!-- JS Injected -->
            </div>

            <div class="cte-nf-modal-footer">
                <button class="cte-nf-btn cte-nf-btn-play" style="padding: 8px 20px; font-size: 0.9rem;" onclick="window.CTEIdolManager.Heartbeat.confirmAssignment()">Start</button>
            </div>
        </div>
    </div>
</div>

<!-- 遮罩层 -->
<div class="cte-idol-popup-overlay" id="cte-idol-overlay" onclick="window.CTEIdolManager.closeAllPopups()"></div>

<!-- 出行菜单 -->
<div id="cte-idol-travel-menu-overlay" onclick="if(event.target === this) window.CTEIdolManager.closeTravelMenu()">
    <div class="cte-idol-travel-menu-box">
        <span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeTravelMenu()">&times;</span>
        <div id="cte-idol-travel-title" style="color:#e0c5a1; margin-bottom:20px;">前往目的地</div>
        <div id="cte-idol-travel-content" class="cte-idol-travel-options"></div>
    </div>
</div>

<!-- 参与者选择弹窗 -->
<div id="cte-idol-participant-popup" class="cte-idol-popup" style="max-width: 400px;">
    <span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeAllPopups()">&times;</span>
    <h3>👥 选择参与人员</h3>
    <p style="font-size:12px; color:#888; margin-bottom:10px;">请勾选参与此行程的成员：</p>
    
    <div id="cte-idol-participant-list" class="cte-idol-participant-grid">
        <!-- JS 动态生成复选框 -->
    </div>
    
    <div style="margin-top:15px; border-top:1px solid #444; padding-top:10px;">
        <p style="font-size:12px; color:#aaa; margin-bottom:5px;">其他人员 (选填):</p>
        <input type="text" id="cte-idol-participant-custom" class="cte-idol-travel-input" placeholder="输入其他名字..." style="width:90%;">
    </div>

    <div style="text-align:center; margin-top:15px; display:flex; gap:10px; justify-content:center;">
        <button class="cte-idol-btn" onclick="window.CTEIdolManager.proceedToLocationSelection()" style="background:#b38b59; color:#1a1a1a;">📍 选择地点</button>
        <button class="cte-idol-btn" onclick="window.CTEIdolManager.closeAllPopups()" style="border-color:#666; color:#888;">取消</button>
    </div>
</div>

<!-- 自定义地点弹窗 -->
<div id="cte-idol-other-places-popup" class="cte-idol-popup">
    <span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeAllPopups()">&times;</span>
    <h3>🗺️ 自定义目的地</h3>
    <p>请输入您想前往的任意地点：</p>
    <div style="text-align: center;">
        <input type="text" id="cte-idol-custom-destination-input" class="cte-idol-travel-input" style="width: 90%; margin-top:10px;" placeholder="例如：海边">
        <button class="cte-idol-btn" onclick="window.CTEIdolManager.goToCustomDestination()">🚀 前往</button>
    </div>
</div>

<!-- 宿舍弹窗 -->
<div id="cte-idol-dorm-popup" class="cte-idol-popup">
    <span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeAllPopups()">&times;</span>
    <h3>🏠 CTE男团宿舍</h3>
    <p>坐落在北区别墅区中的CTE男团宿舍，安保和私密性都是顶级。</p>
    <img src="https://files.catbox.moe/qn281x.JPG" class="cte-idol-popup-image">
    <div style="text-align: center;">
        <button class="cte-idol-btn" onclick="window.CTEIdolManager.showPopup('cte-idol-dorm-detail-popup')">🚪 宿舍内部</button>
        <button class="cte-idol-btn" onclick="window.CTEIdolManager.openTravelMenu('CTE男团宿舍')">🚀 前往</button>
    </div>
</div>

<!-- 宿舍详情 -->
<div id="cte-idol-dorm-detail-popup" class="cte-idol-popup">
    <span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeAllPopups()">&times;</span>
    <h3>🛋️ 宿舍内部</h3>
    <div class="cte-idol-interior-container">
        <img src="https://files.catbox.moe/40ygiw.JPG" class="cte-idol-interior-image">
        <div class="cte-idol-floor-nav">
            <button class="cte-idol-floor-btn" onclick="window.CTEIdolManager.openRooftopMenu()">1. 屋顶：天台花园酒吧</button>
            <button class="cte-idol-floor-btn" onclick="window.CTEIdolManager.openSubMenu('五楼：私人宿舍区', ['秦述', '司洛', '鹿言', '魏星泽', '周锦宁', '谌绪', '孟明赫', '亓谢', '魏月华', '桑洛凡', '你', '公共书房/阅览区'])">2. 五楼：私人宿舍区</button>
            <button class="cte-idol-floor-btn" onclick="window.CTEIdolManager.openSubMenu('四楼：健康与恢复区', ['健身房', '瑜伽与冥想室', '水疗与按摩室', '健康管理室'])">3. 四楼：健康与恢复区</button>
            <button class="cte-idol-floor-btn" onclick="window.CTEIdolManager.openSubMenu('三楼：专业练习区', ['主舞蹈室', '声乐录音棚', '造型与衣帽间', '成员休息室', '会议室'])">4. 三楼：专业练习区</button>
            <button class="cte-idol-floor-btn" onclick="window.CTEIdolManager.openSubMenu('二楼：个人创作与娱乐区', ['周锦宁个人工作室', '孟明赫个人工作室', '乐器练习室', '游戏娱乐室', '私人会客厅', '收藏室'])">5. 二楼：个人创作与娱乐区</button>
            <button class="cte-idol-floor-btn" onclick="window.CTEIdolManager.openSubMenu('一楼：生活与休闲区', ['前院与玄关', '客厅/公共休息区', '开放式厨房与餐厅', '储藏室与洗衣房', '后院与露天泳池'])">6. 一楼：生活与休闲区</button>
        </div>
        <div id="cte-idol-interior-sub-menu" class="cte-idol-sub-menu-overlay">
            <div id="cte-idol-sub-menu-title" style="color:#b38b59; font-size:20px; margin-bottom:20px;"></div>
            <div id="cte-idol-sub-menu-content" class="cte-idol-sub-menu-grid"></div>
            <div class="cte-idol-sub-menu-close" style="margin-top:20px; cursor:pointer;" onclick="window.CTEIdolManager.closeSubMenu()">[ 关闭菜单 ]</div>
        </div>
    </div>
</div>

<!-- 其他地点 -->
<div id="cte-idol-office-popup" class="cte-idol-popup"><span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeAllPopups()">&times;</span><h3>🏢 森云制药</h3><p>主营药物研发、生产和销售的家族企业。</p><div style="text-align:center"><button class="cte-idol-btn" onclick="window.CTEIdolManager.openTravelMenu('远洋集团')">🚀 前往</button></div></div>
<div id="cte-idol-villa-popup" class="cte-idol-popup"><span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeAllPopups()">&times;</span><h3>🏰 私人别墅</h3><p>位于京港北区的一栋独栋别墅。</p><div style="text-align:center"><button class="cte-idol-btn" onclick="window.CTEIdolManager.openTravelMenu('私人别墅')">🚀 前往</button></div></div>
<div id="cte-idol-office2-popup" class="cte-idol-popup"><span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeAllPopups()">&times;</span><h3>☕ 万城娱乐</h3><p>国内最大的娱乐产业集团之一。</p><div style="text-align:center"><button class="cte-idol-btn" onclick="window.CTEIdolManager.openTravelMenu('万城娱乐')">🚀 前往</button></div></div>
<div id="cte-idol-office3-popup" class="cte-idol-popup"><span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeAllPopups()">&times;</span><h3>🏢 盛华集团</h3><p>老牌实业集团，在本地拥有深厚根基。</p><div style="text-align:center"><button class="cte-idol-btn" onclick="window.CTEIdolManager.openTravelMenu('盛华集团')">🚀 前往</button></div></div>
<div id="cte-idol-office4-popup" class="cte-idol-popup"><span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeAllPopups()">&times;</span><h3>🏢 隆桑集团</h3><p>京港市的新兴科技巨头。</p><div style="text-align:center"><button class="cte-idol-btn" onclick="window.CTEIdolManager.openTravelMenu('隆桑集团')">🚀 前往</button></div></div>
<div id="cte-idol-highschool-popup" class="cte-idol-popup"><span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeAllPopups()">&times;</span><h3>🏫 京港第三高中</h3><p>京港市著名的重点高中。</p><div style="text-align:center"><button class="cte-idol-btn" onclick="window.CTEIdolManager.openTravelMenu('京港第三高中')">🚀 前往</button></div></div>
<div id="cte-idol-gov-popup" class="cte-idol-popup"><span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeAllPopups()">&times;</span><h3>🏛️ 京港市政府</h3><p>城市行政中心。</p><div style="text-align:center"><button class="cte-idol-btn" onclick="window.CTEIdolManager.openTravelMenu('京港市政府')">🚀 前往</button></div></div>
<div id="cte-idol-PrivateClub-popup" class="cte-idol-popup"><span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeAllPopups()">&times;</span><h3>🍷 私人会所</h3><p>仅限会员进入的高级会所，隐秘性极高。</p><div style="text-align:center"><button class="cte-idol-btn" onclick="window.CTEIdolManager.openTravelMenu('私人会所')">🚀 前往</button></div></div>
<div id="cte-idol-TVstation-popup" class="cte-idol-popup"><span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeAllPopups()">&times;</span><h3>📺 京港电视台</h3><p>城市媒体中心，众多节目的录制现场。</p><div style="text-align:center"><button class="cte-idol-btn" onclick="window.CTEIdolManager.openTravelMenu('京港电视台')">🚀 前往</button></div></div>
<div id="cte-idol-airport-popup" class="cte-idol-popup"><span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeAllPopups()">&times;</span><h3>✈️ 机场</h3><p>连接京港与世界的交通枢纽。</p><div style="text-align:center"><button class="cte-idol-btn" onclick="window.CTEIdolManager.openTravelMenu('机场')">🚀 前往</button></div></div>
<div id="cte-idol-port-popup" class="cte-idol-popup"><span class="cte-idol-close-btn" onclick="window.CTEIdolManager.closeAllPopups()">&times;</span><h3>⚓ 港口</h3><p>繁忙的国际货运港口。</p><div style="text-align:center"><button class="cte-idol-btn" onclick="window.CTEIdolManager.openTravelMenu('港口')">🚀 前往</button></div></div>


